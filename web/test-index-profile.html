<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Menu Profil Index</title>
    <link href="./public/assets/css/style.css" rel="stylesheet">
    <link href="./public/assets/css/profile-menu.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
</head>
<body>
    <div style="padding: 20px; background: #f5f5f5; min-height: 100vh;">
        <h1>Test Menu Profil - Page Index</h1>
        
        <div style="margin: 20px 0;">
            <button onclick="simulateLogin()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                Simuler Connexion
            </button>
            <button onclick="simulateLogout()" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                Simuler D√©connexion
            </button>
        </div>

        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h3>Section d'authentification (comme dans index.html)</h3>
            <div id="auth-section" class="flex items-center">
                <!-- Le contenu sera inject√© dynamiquement -->
                <button class="btn-login">Se connecter</button>
            </div>
        </div>

        <div style="margin-top: 20px; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h3>Logs de d√©bogage</h3>
            <div id="debug-logs" style="background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
                <!-- Les logs appara√Ætront ici -->
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="./src/js/main.js"></script>
    <script src="./src/js/login-redirect-utils.js"></script>
    <script src="./src/js/profile-menu.js"></script>
    <script src="./src/js/auth-state-manager.js"></script>

    <script>
        // Fonction pour ajouter des logs
        function addLog(message) {
            const logsDiv = document.getElementById('debug-logs');
            const timestamp = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        // Simuler une connexion
        function simulateLogin() {
            const userData = {
                id: 1,
                first_name: 'John',
                last_name: 'Doe',
                email: 'john.doe@example.com',
                role: 'user'
            };
            
            sessionStorage.setItem('userData', JSON.stringify(userData));
            sessionStorage.setItem('authToken', 'fake-token-123');
            
            addLog('‚úÖ Connexion simul√©e - Donn√©es utilisateur stock√©es');
            
            // D√©clencher la v√©rification d'√©tat
            if (window.authStateManager) {
                window.authStateManager.checkAuthState();
                addLog('üîÑ √âtat d\'authentification v√©rifi√©');
            }
        }

        // Simuler une d√©connexion
        function simulateLogout() {
            sessionStorage.clear();
            localStorage.clear();
            
            addLog('üîì D√©connexion simul√©e - Donn√©es nettoy√©es');
            
            // D√©clencher la v√©rification d'√©tat
            if (window.authStateManager) {
                window.authStateManager.checkAuthState();
                addLog('üîÑ √âtat d\'authentification v√©rifi√©');
            }
        }

        // Intercepter les logs de la console
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;

        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog('üìù ' + args.join(' '));
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog('‚ö†Ô∏è ' + args.join(' '));
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('‚ùå ' + args.join(' '));
        };

        // V√©rifier que les scripts sont charg√©s
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üöÄ Page charg√©e');
            
            if (window.authStateManager) {
                addLog('‚úÖ AuthStateManager disponible');
            } else {
                addLog('‚ùå AuthStateManager non disponible');
            }
            
            if (window.toggleAnyProfileMenu) {
                addLog('‚úÖ toggleAnyProfileMenu disponible');
            } else {
                addLog('‚ùå toggleAnyProfileMenu non disponible');
            }
        });
    </script>
</body>
</html> 